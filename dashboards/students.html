<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Innovation in Civil Engineering Society</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="Logged in.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo">
        <img src="images/mubasiceslogo.png" alt="CESociety Logo" class="nav-logo">
      </a>

      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="innovations.html">Innovations</a></li>
        <li><a href="studentside/events.html">Events</a></li>
        <li><a href="studentside/payments.html">Payments</a></li>
        <li><a href="support.html">Support</a></li>
        <li><a href="profile.html">Profile</a></li>
      </ul>

      <!-- User info and logout section -->
      <div class="user-section">
        <span class="user-name" id="userName">Student</span>
        <button class="logout-btn" id="logoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>

      <div class="hamburger">
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
  </nav>

  <div class="welcome-section">
    <h1>Welcome to Student Dashboard</h1>
    <div class="welcome-line"></div>
    <p>This is your student portal where you can manage your ICES membership and activities. Here you can:</p>
    <ul class="welcome-features">
      <li>Register for upcoming events</li>
      <li>Make membership payments</li>
      <li>Connect with other members for support</li>
      <li>Access learning resources</li>
      <li>Get assistance from the community</li>
    </ul>

    <!-- Test Register/Login (temporary) -->
    <div id="api-test" style="margin-top:16px;border:1px solid #ddd;padding:12px;border-radius:8px">
      <h3>API Test: Register & Login</h3>
      <div style="display:grid;gap:8px;max-width:420px">
        <input id="test-name" placeholder="Full name" />
        <input id="test-email" placeholder="Email" />
        <input id="test-password" type="password" placeholder="Password" />
        <div style="display:flex;gap:8px">
          <button id="btn-test-register">Test Register (student)</button>
          <button id="btn-test-login">Test Login</button>
        </div>
        <small id="test-status"></small>
      </div>
    </div>
  </div>

<!-- ===== FOOTER ===== -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo-section">
        <img src="images/mubasiceslogo.png" alt="ICES Logo" class="footer-logo">
        <p class="footer-description">Innovation in Civil Engineering Society (ICES) is dedicated to fostering excellence and innovation in civil engineering practices across Malawi.</p>
      </div>
      
      <div class="footer-links">
        <h3>Quick Links</h3>
        <ul>
         <li><a href="students.html">Home</a></li>
        <li><a href="innovations.html">Innovations</a></li>
        <li><a href="studentside/events.html">Events</a></li>
        <li><a href="studentside/payments.html">Payments</a></li>
        <li><a href="support.html">Support</a></li>
        <li><a href="profile.html">Profile</a></li>
        </ul>
      </div>

      <div class="footer-social">
        <h3>Connect With Us</h3>
        <div class="social-links">
          <a href="#" class="social-link"><i class="fab fa-facebook"></i> Facebook</a>
          <a href="#" class="social-link"><i class="fab fa-twitter"></i> Twitter</a>
          <a href="#" class="social-link"><i class="fab fa-linkedin"></i> LinkedIn</a>
          <a href="#" class="social-link"><i class="fab fa-instagram"></i> Instagram</a>
          <a href="#" class="social-link"><i class="fab fa-youtube"></i> YouTube</a>
        </div>
        <div class="contact-info">
          <h3>Contact Info</h3>
          <p><i class="fas fa-map-marker-alt"></i> MUST Campus, Limbe, Malawi</p>
          <p><i class="fas fa-phone"></i> +265 888 123 456</p>
          <p><i class="fas fa-envelope"></i> info@ices.org.mw</p>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container">
        <p>&copy; 2025 Innovation in Civil Engineering Society. All Rights Reserved.</p>
        <p>Designed by ICES</p>
      </div>
    </div>
  </footer>
  
  <!-- Page scripts -->
  <script type="module">
    import { API, safeFetch } from '../public/api.js';

    const statusEl = document.getElementById('test-status');
    const nameEl = document.getElementById('test-name');
    const emailEl = document.getElementById('test-email');
    const passEl = document.getElementById('test-password');

    function setStatus(msg) {
      if (statusEl) statusEl.textContent = msg;
      console.log('[API Test]', msg);
    }

    // Test Register (student)
    document.getElementById('btn-test-register')?.addEventListener('click', async () => {
      const name = nameEl?.value?.trim();
      const email = emailEl?.value?.trim();
      const password = passEl?.value || '';
      if (!name || !email || !password) {
        alert('Enter name, email, and password');
        return;
      }
      setStatus('Registering...');
      try {
        const res = await API.registerUser({ name, email, password, year: 1 });
        alert(res.message || 'Registration successful');
        setStatus('Registration OK');
      } catch (err) {
        setStatus('Registration failed');
      }
    });

    // Test Login
    document.getElementById('btn-test-login')?.addEventListener('click', async () => {
      const email = emailEl?.value?.trim();
      const password = passEl?.value || '';
      if (!email || !password) {
        alert('Enter email and password');
        return;
      }
      setStatus('Logging in...');
      try {
        const data = await API.loginUser({ email, password });
        // Fallback to unified login if your backend uses /api/login
        // const data = await safeFetch('/api/login', { method: 'POST', body: { email, password } });

        if (data.role) {
          localStorage.setItem('userData', JSON.stringify({
            userId: data.userId,
            email: data.email,
            name: data.name || data.username || '',
            role: data.role,
            loginTime: new Date().toISOString()
          }));
          alert('Login successful');
          setStatus('Login OK');
        } else {
          alert(data.message || 'Login failed');
          setStatus('Login failed');
        }
      } catch (err) {
        setStatus('Login failed');
      }
    });
  </script>
  <script src="logged in.js"></script>
</body>
</html>
